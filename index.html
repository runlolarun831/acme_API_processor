<html>
  <head>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js'></script>
  </head>
  <body>
    <script>
      const loadData = async()=> {
        const urls = [
          'https://acme-users-api-rev.herokuapp.com/api/companies',
          'https://acme-users-api-rev.herokuapp.com/api/products',
          'https://acme-users-api-rev.herokuapp.com/api/offerings',
        ];
      const responses = await Promise.all(urls.map( url=> axios.get(url)));

      const [companies, products, offerings ] = responses.map( response => response.data);
      //console.log(companies);
/*
      //return products within a price range
      const findProductsInPrice = (products, range) => products.filter(product => product.suggestedPrice >= range.min && product.suggestedPrice <= range.max);

      const productsInPriceRange = findProductsInPrice(products, { min: 1, max: 15});
      console.log(productsInPriceRange);
*/
/*
      // returns object where key is first letter of company name
      // value for each key is the array of those companies
      const groupCompaniesByLetter = (companies) => {
        const compNameObj = {};
        companies.map(company => {
          let first = (company.name).charAt(0);
          if( !(first in compNameObj)) {
            compNameObj[first] = [company];
          }
          else {
            compNameObj[first].push(company);
          }
        } )
        return compNameObj;
      };

      const groupedCompaniesByLetter = groupCompaniesByLetter(companies);
      console.log(groupedCompaniesByLetter);
*/
/*
      // returns object where key is a state
      // value for each key is the array of those companies in that state
      const groupCompaniesByState = (companies) => {
        const compStateObj = {};
        companies.map( company => {
          let compState = company.state;
        if ( !(compState in compStateObj)) {
            compStateObj[compState] = [company];
          }
        else {
            compStateObj[compState].push(company);
          }
        })
        return compStateObj;
      };

      const groupedCompaniesByState = groupCompaniesByState(companies);
      console.log(groupedCompaniesByState);
*/


// returns an array of offerings with each offering having a company and product

// const processOfferings = ({ companies, products, offerings}) => {
//     const newOfferings = [];

//   [...offerings].map(offer => {
//     const offProdCo = {...offer};
//     const prodMatchID = [...products].find( product => {
//       return product.id === offer.productId
//     });
//     offProdCo.product = prodMatchID.name;

//     const compMatchID = [...companies].find(company => {
//       return company.id === offer.companyId
//     });
//     offProdCo.company =compMatchID.name;
//     newOfferings.push(offProdCo);
//   } );
//   return newOfferings;
// }

// const processedOfferings = processOfferings( { companies, products, offerings});
// console.log(processedOfferings);


//returns the companies that have n or more offerings

const companiesByNumberOfOfferings = (companies, offerings, n) => {
  //console.log(companies);
  //console.log( 'this is companies sample');
  //console.log(companies[0]);
  //console.log(companies[0].id);

  //console.log(offerings);
  //console.log( 'this is offerings sample');
  //console.log(offerings[0]);
  //console.log(offerings[0].productId);
  const returnArr = [];
  for(let i = 0; i < companies.length; i++) {
    console.log('hey');
    console.log(companies[i].id);
    const collectArr = [];
    for(let j = 0; j <offerings.length; j++) {
      console.log(offerings[j].companyId);
      if(companies[i].id === offerings[j].companyId) {
        console.log(companies[i].id, ' ==== ' , offerings[j].companyId);
        collectArr.push(offerings[j]);
      }
    }
    console.log('collArr ' ,collectArr);
     if( collectArr.length >= n) {
       returnArr.push(companies[i]);
     }
  }
  return returnArr;
}

//returns the companies that have n or more offerings
const threeOrMoreOfferings = companiesByNumberOfOfferings(companies, offerings, 3);
console.log(threeOrMoreOfferings);

  } ;
  loadData();

    </script>
  </body>
</html>
